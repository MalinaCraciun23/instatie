<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InStație Documentație</title>

    <link rel="stylesheet" href="css/scholarly.min.css">
    <script src="js/scholarly.min.js"></script>
</head>

<body>

    <div role="content-info">
        <h1>InStație Documentație</h1>
        <section typeof="sa:ProjectLinks">
            <ul>
                <li typeof="schema:WebPage" role="link" resource="https://github.com/Amihaeseisergiu/GaSM"
                    property="schema:citation" id="github">
                    <cite property="schema:name">
                        <a href="https://github.com/MikeAwie/instatie">Github</a>
                    </cite>
                </li>
                <li typeof="schema:WebPage" role="link" resource="https://app.swaggerhub.com/apis/GaSM/GaSM/1.0.0#/"
                    property="schema:citation" id="github">
                    <cite property="schema:name">
                        <a href="">Swagger</a>
                    </cite>
                </li>
            </ul>
        </section>

        <section typeof="sa:AuthorsList">
            <h2>Autori</h2>
            <ul>
                <li typeof="sa:ContributorRole" property="schema:author">
                    <span typeof="schema:Person">
                        <meta property="schema:givenName" content="Mike">
                        <meta property="schema:familyName" content="AlOwe">
                        <span property="schema:name">Al Owe Mike</span>
                    </span>
                    <ul>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="mike.awie@yahoo.com" property="schema:email">mike.awie@yahoo.com</a>
                        </li>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="telephone:+40774521935" property="schema:telephone">+40774521935</a>
                        </li>
                    </ul>
                </li>
                <li typeof="sa:ContributorRole" property="schema:author">
                    <span typeof="schema:Person">
                        <meta property="schema:givenName" content="Malina">
                        <meta property="schema:familyName" content="Craciun">
                        <span property="schema:name">Crăciun Mălina</span>
                    </span>
                    <ul>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="hmally564@gmail.com" property="schema:email">hmally564@gmail.com</a>
                        </li>
                        <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                            <a href="telephone:+40742794109" property="schema:telephone">+40742794109</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </section>

        <h2>Cuprins</h2>
        <ol role="directory">
            <li>
                <a href="#introducere">
                    <span> 1. </span>
                    Introducere
                </a>
            </li>
            <li>
                <a href="#database">
                    <span> 2. </span>
                    Database
                </a>

                <ol role="directory">
                    <li>
                        <a href="#stationdb">
                            <span> 2.1. </span>
                            Tabelul station
                        </a>
                    </li>
                    <li>
                        <a href="#routedb">
                            <span> 2.2. </span>
                            Tabelul route
                        </a>
                    </li>
                    <li>
                        <a href="#route_stationdb">
                            <span> 2.3. </span>
                            Tabelul route_station
                        </a>
                    </li>
                    <li>
                        <a href="#newsdb">
                            <span> 2.4. </span>
                            Tabelul news
                        </a>
                    </li>
                </ol>
            </li>
            <li>
                <a href="#front-end">
                    <span> 3. </span>
                    Front End
                </a>

                <ol role="directory">
                    <li>
                        <a href="#stirifront">
                            <span> 3.1. </span>
                            Stiri
                        </a>
                    </li>
                    <li>
                        <a href="#hartafront">
                            <span> 3.2. </span>
                            Harta
                        </a>
                    </li>
                    <li>
                        <a href="#statiifront">
                            <span> 3.3. </span>
                            Statii
                        </a>
                    </li>
                    <li>
                        <a href="#exportfront">
                            <span> 3.4. </span>
                            Export
                        </a>
                    </li>
                </ol>
            </li>
            <li>
                <a href="#back-end">
                    <span> 4. </span>
                    Back End
                </a>

                <ol role="directory">
                    <li>
                        <a href="#dbpopulationback">
                            <span> 4.1. </span>
                            Database Population
                        </a>
                    </li>
                    <li>
                        <a href="#routefindback">
                            <span> 4.2. </span>
                            Route Finder
                        </a>
                    </li>
                    <li>
                        <a href="#timecalcback">
                            <span> 4.3. </span>
                            Time Calculator
                        </a>
                    </li>
                </ol>
            </li>
            <li>
                <a href="#references">
                    <span> 5.</span>
                    References
                </a>
            </li>
        </ol>
    </div>

    <section id="introducere">

        <h3>
            Introducere
        </h3>
        <p>
            "InStatie" este o aplicație concepută pentru urmărirea transportului public din Iași.
        </p>
    </section>

    <section id="database">

        <h3>
            Database
        </h3>
        <p>Folosim baza de date PostgreSQL impreuna cu extensia PostGIS pentru a salva coordonatele statiilor si a
            rutelor.
            Pentru a interactiona cu baza de date folosim query builder-ul Knex.js impreuna cu extensia knex-postgis
            pentru a avea access la functiile suplimentare din PostGIS.
        </p>
        <section id="stationdb">
            <h3>
                Tabelul station
            </h3>
            <p>Asa arata tabelul station, acesta fiind tabelul unde vor fi stocate toate detaliile legate de
                statii:</p>
            <figure typeof="sa:image">
                <img src="images/station.png">
                <figcaption>Fig.1 - Structura tabelului station</figcaption>
            </figure>
        </section>

        <section id="routedb">
            <h3>
                Tabelul route
            </h3>
            <p>Asa arata structura tabelului route acesta fiind tabelul unde vor fi stocate toate detaliile legat de
                rutele de transport:</p>
            <figure typeof="sa:image">
                <img src="images/route.png">
                <figcaption>Fig.2 - Structura tabelului route</figcaption>
            </figure>
        </section>

        <section id="route_stationdb">
            <h3>
                Tabelul route_station
            </h3>

            <p>Acest tabel este un join table care face legatura intre tabelele station si route pentru a sti prin ce
                statii trece o ruta. De asemenea salvam numarul statiei in ruta respectiva ca sequence</p>
            <p>Asa arata structura tabelului route_station:</p>
            <figure typeof="sa:image">
                <img src="images/route_station.png">
                <figcaption>Fig.3 - Structura tabelului route_station</figcaption>
            </figure>
        </section>

        <section id="newsdb">
            <h3>
                Tabelul news
            </h3>

            <p>Acest tabel retine stiri legate de transportul public din iasi</p>
            <p>Asa arata structura tabelului news:</p>
            <figure typeof="sa:image">
                <img src="images/news.png">
                <figcaption>Fig.4 - Structura tabelului news</figcaption>
            </figure>

        </section>
    </section>

    <section id="front-end">

        <h3>
            Front End
        </h3>
        <p>Aplicatia de Front End este un PWA (progressive web application) si respecta toate conditiile pentru a fi
            unul</p>
        <p>Este responsive, functioneaza pe toate device-urile</p>
        <p>Se poate instala pe device datorita web manifest-ului</p>
        <p>Are un service-worker care face cache la request-uri si le salveaza in IndexedDB pentru a fi valabile si
            offline</p>
        <p>Este servit pe HTTPS https://instatie.ro/</p>
        <br>
        <p>Aplicatia a fost dezvoltata folosind web-components (HTML Templates, Custom Elements si Shadow DOM) pentru o
            experienta de dezvoltare mai placuta</p>
        <section id="stirifront">
            <h3>
                Stiri
            </h3>
            <p>Aceasta pagina preia stirile din back-end si le afiseaza in aplicatie</p>
        </section>

        <section id="hartafront">
            <h3>
                Harta
            </h3>

            <p>Pe aceasta pagina este pusa la dispozitie o harta OSM dezvoltata folosind Leaflet</p>
            <p>Pe harta sunt afisate toate statiile din oras si, in timp real, pozitiile tuturor vehiculelor, preluate
                folosind Server Sent Events</p>
            <p>De asemenea este afisata si pozitia user-ului, daca acesta permite acest lucru</p>
            <figure typeof="sa:image">
                <img src="images/harta.png" width="900">
                <figcaption>Fig.5 - Exemplu de harta cu statii si locatii</figcaption>
            </figure>
        </section>

        <section id="statiifront">
            <h3>
                Statii
            </h3>

            <p>In aceasta pagina user-ul poate cauta si selecta o statie pentru a vedea vehiculele care vin spre aceasta
                si timpul aproximativ ramas.</p>
        </section>

        <section id="exportfront">
            <h3>
                Export
            </h3>

            <p>Aceasta pagina ofera posibilitatea de a descarca date legate de statii, rute si stiri in format CSV.</p>
        </section>

    </section>

    <section id="back-end">

        <h3>
            Back End
        </h3>

        <section id="dbpopulationback">
            <h3>
                Database Population
            </h3>
            <p>Baza de date este populata efectuand web scraping pe site-ul SCTP Iasi si utilizand API-ul oferit de Wink
                Multimedia.</p>
            <p>Sunt Populate toate 4 tabelele, acest proces ruland sub un cronjob in fiecare zi</p>
        </section>

        <section id="routefindback">
            <h3>
                Route Finder
            </h3>
            <p>Datele despre locatia vehiculelor in timp real oferite de SCTP Iasi prin API-ul Opendata le lipseste ruta
                pe care merge vehiculul.</p>
            <p>Am implementat un algoritm care incearca sa gaseasca ruta vehiculelor, mapand cursa lor cu rutele din
                baza de date</p>
            <p>Vehiculele sunt improspatate la fiecare 30 de secunde si in acelasi timp ruleaza algoritmul de gasire a
                rutei</p>



            <figure typeof="schema:SoftwareSourceCode">
                <pre>
					const evaluatePossibleRoutes = (name, possibleRoutes) => {
                        if (!vehiclePossibleRoutes[name]) {
                          if (possibleRoutes.length) {
                            vehiclePossibleRoutes[name] = possibleRoutes;
                          }
                        } else if (!vehiclePossibleRoutes[name].length) {
                          vehiclePossibleRoutes[name] = possibleRoutes;
                        } else {
                          const commonPossibleRoutes = possibleRoutes.filter((possibleRoute) =>
                            vehiclePossibleRoutes[name].includes(possibleRoute),
                          );
                          vehiclePossibleRoutes[name] = commonPossibleRoutes.length ? commonPossibleRoutes : possibleRoutes;
                        }
                        if (vehiclePossibleRoutes[name] && vehiclePossibleRoutes[name].length === 1) {
                          vehicles[name].route = vehiclePossibleRoutes[name][0];
                          delete vehiclePossibleRoutes[name];
                        }
                      };
				</pre>
            </figure>

        </section>
        <section id="timecalcback">
            <h3>
                Time Calculator
            </h3>
            <p>Pentru a determina vehiculele care urmeaza sa ajunga intr-o statie si timpul ramas pana ajung, ne folosim
                de vehiculele pentru care deja am gasit ruta si incercam sa gasim unde sunt exact in acea ruta si care
                sunt urmatoarele statii.</p>
            <p>Dupa ce am gasit urmatoarele statii apelam la un API oferit de Waze pentru a calcula timpul necesar
                pentru ca vehiculul sa ajunga la acea statie.</p>
        </section>

    </section>
</body>

</html>